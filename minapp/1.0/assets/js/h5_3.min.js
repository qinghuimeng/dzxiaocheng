/*插件活动报名*/
        function joinin_show(){
             window.ontouchmove=function(e){
                e.preventDefault && e.preventDefault();
                e.returnValue=false;
                e.stopPropagation && e.stopPropagation();
                return false;
            }        
            $('.shade').show();
            $('.join_show').show();
            var div=$('.join_show');
            $('.join_show').css('left',parseInt(($(window).width()-div.width())/2));
            $('.join_show').css('top',parseInt(($(window).height()-div.height())/2+$(document).scrollTop()));
        }
        $('.event-go').click(function(){
            joinin_show();
        })
        // 取消
        $('.jclance').click(function(event) {
            $('.join_show').hide();
            $('.shade').hide();
            window.ontouchmove=function(e){
                e.preventDefault && e.preventDefault();
                e.returnValue=true;
                e.stopPropagation && e.stopPropagation();
                return true;
            }
        });
        $('.jconfirm').click(function(event) {
            window.ontouchmove=function(e){
                e.preventDefault && e.preventDefault();
                e.returnValue=true;
                e.stopPropagation && e.stopPropagation();
                return true;
            }
            var auth = auth;
            var message = $('#message').val() || '';
            auth = encodeURIComponent(auth);
//            href = location.href+'&auth='+auth;
            href = location.href;
            var oparams = $('#xjactive').serialize();
            if (oparams) {
                var d = oparams.split('&');
                for (var i = d.length - 1; i >= 0; i--) {
                    var dd = d[i].split('=');
                    if(!trim(dd[1])) {
                        alert('带 "*" 号为必填项，请填写完整');
                        return;
                    }
                }
            }
            $.ajax({
                 type: "POST",
                 url: siteurl+"index.php?mod=xj_event&ishtml=1&message="+message+'&'+decodeURI(oparams),
                 data: xj_params,
                 dataType: "html",
                 success: function(data){
                        $('.join_show').hide();
                        $('.shade').hide();
                        v_dialog(data);
                    }
             });
        });
       $('.quxiao').click(function(){
           if(confirm("是否取消报名？")) {
                var auth = auth;
                auth = encodeURIComponent(auth);
//                href = location.href+'&auth='+auth;
                href = location.href;
               params =xj_params;
                $.ajax({
                     type: "POST",
                     url: "<?php echo $_G['siteurl'] ?>index.php?mod=xj_event&action=cannel&ishtml=1",
                     data: params,
                     dataType: "html",
                     success: function(data){
                                v_dialog(data);
                            }
                 });
            }
        })
//    function loaded () {
//        var myScroll;	
//        auth = auth;
//        tid = tid;;
//        totalpage = totalpage;
//        currentpage = 2;
//        //当前页大于总页数，无需加载
//        if(currentpage > totalpage){
//            return false;
//        }
//        myScroll = new IScroll('#wrapper', { probeType: 3, mouseWheel: true,click: true });	
//        myScroll.on("slideDown",function(){
//                if(this.y > 40){
//                    currentpage--;
//                    var url = baseurl+mocuz_type+"index.php?mod=viewthread&tid="+tid+"&item_view=1&page="+currentpage+"&auth="+auth;
//                    if(MocuzMobile.Android()) {
//                        window.myjs.loaded_page(""+url);//android
//                        return;
//                    }
//                    if(MocuzMobile.iOS()) {
//                        var cmd='loaded_page';
//                        window.location.href="objc://"+cmd+":/"+url;
//                        return;
//                    }
//                }
//        });
//        myScroll.on("slideUp",function(){
//                if(this.maxScrollY - this.y > 40){
//                    currentpage++;
//                    var url = baseurl+mocuz_type+"index.php?mod=viewthread&tid="+tid+"&item_view=1&page="+currentpage+"&auth="+auth;
//                    if(MocuzMobile.Android()) {
//                        window.myjs.praise();//android
//                        return;
//                    }
//                    if(MocuzMobile.iOS()) {
//                        window.location.href="objc://praise";
//                        return;
//                    }
//                }
//        });
//  }
 // 快捷回复委托方法
    function odz_quick_reply() {
        var author = forum_author;
        if (MocuzMobile.Android()) {
            window.myjs.changePage(""+tid, "", "", ""+authorid);//android
            return;
        }
        if (MocuzMobile.iOS()) {
            var cmd = "changePage";
            window.location.href="objc://"+cmd+":/"+tid+"///"+authorid;
        }
    }
    function get_uids(uid){
        get_uid = uid;
    }
    function test_pid_Praise(id,idtype,type,uid){
        if(!uid){
            if(!get_uid){
                if(MocuzMobile.Android()) {
                    window.myjs.get_uid();//android
		    return;
                }
                if(MocuzMobile.iOS()) {
                     window.location.href="objc://get_uid";
		     return;
                }
            }
            uid = get_uid;
        }
        $.ajax({
             type: "POST",
             url: siteurl+"index.php?mod=praisethread&id="+id+"&idtype="+idtype+"&type="+type+"&uid="+uid,
             dataType: "html",
             success: function(data){
                 var datas=eval("("+data+")");
                 if(datas.status==1){
                    var follow_view = "<img src='assets/images/praise.png' onclick=test_pid_Praise(" +id+ ",'" +idtype+ "','delete','" +uid+ "')>\n\
<span class='discuss_zan'>"+datas.praisenum+" </span>";
                    $(".pid_praise").html('');
                    $(".pid_praise"+id).html(follow_view);return;
                 }else if(datas.status==2){
                     var follow_view = "<img src='assets/images/zan.png' onclick=test_pid_Praise(" +id+ ",'" +idtype+ "','click','" +uid+ "')>\n\
<span class='discuss_zan'>"+datas.praisenum+" </span>";
                    $(".pid_praise").html('');
                    $(".pid_praise"+id).html(follow_view);return;
                 }
                alert(datas.message);
             }
        });
    }
    // 管理员对贴子操作参数传递
    function topic_manage(pid,groudstatus) {
        // 调用客户端编辑帖子方法
        if (MocuzMobile.Android()) {
            window.myjs.topic_manage(""+fid, ""+tid, ""+pid, "delpost",""+groudstatus);
            return;
        }
        if (MocuzMobile.iOS()) {
            var cmd = "topic_manage";
            window.location.href="objc://"+cmd+":/"+fid+"/"+tid+"/"+pid+"/delpost/"+groudstatus;
        }
    }
    //论坛h5客户端加载
    function testClick(cmd, pid, author,authorid){
        var author = author || forum_author;
        if(MocuzMobile.Android()) {
            window.myjs.changePage(""+tid, ""+pid, ""+author, ""+authorid);//android
            return;
        }
        if(MocuzMobile.iOS()) {
            window.location.href="objc://"+cmd+":/"+tid+"/"+author+"/"+pid+"/"+authorid;
        }
    }
    //跳转个人中心
    function lbsPerson(user_id){
        var user_id = '{"user_id":' + user_id + '}';
        if(MocuzMobile.Android()) {
            window.myjs.lbsPerson(user_id);//android
            return;
        }
        if(MocuzMobile.iOS()) {
            var cmd = "lbsPerson";
            window.location.href="objc://"+cmd+":/"+user_id;
            return;
        }
    }

    function jiaohu() {
		var favstatus = favid > 0 ? 1 : 0; // 帖子收藏状态
        var json = '{"replies_pagecount":'+replies_pagecount+'}';
		var json = '{"shoucang":'+favstatus+', "replies_pagecount":'+replies_pagecount+', "shareSNS":{"sharelink":"'+sharelink+'","shareIcon":"'+shareIcon+'", "sharetext":"'+share_text+'", "sharesubject":"'+subject+'"}}';
        
        if (MocuzMobile.Android()) {
            window.shareInfo.jiaohu(json);
        }
        if (MocuzMobile.iOS()) {
            var cmd = "jiaohu";
            window.location.href = "objc://"+cmd+":/"+json;
        }
    }

    $(function() {
        cmtFixed(view_pids);
        jiaohu();
    })
     //百度推送锚点
    function cmtFixed(pid){
        if(pid){
            var changeLi=".discuss_ulA li[pid="+pid+"]";
            var toScroll=$(changeLi).offset();
            if(typeof(toScroll) == "undefined"){
                return;
            }else{
                $("html,body").animate({scrollTop:toScroll.top},1000);
            }  
        }
    }
     // 详情页评论翻页
    function replies_page() {
        if (MocuzMobile.Android()) {
            window.myjs.replies_page(""+replies_pagecount);//android
            return;
        }
        if (MocuzMobile.iOS()) {
            var cmd = "replies_page";
            window.location.href="objc://"+cmd+":/"+replies_pagecount;
        }
    }
    tagindex = 1;
    function  postParameter(uid,username,message) {
        var divFeedList = $("div.bbs-feed-list");
        var divFeedItem = divFeedList.find("div.itm");
        var author=ucenterurl+"/avatar.php?uid="+uid+"&size=small";
        var html ='';
            html+= "<li class='item-view'>";
            html+=  "<div class='discuss_box '>";
            html+=  "<a href='javascript:void(0);' ><img class='discuss_portrait' src="+author+"></a>";
            html+=  "<div class='discuss_user'>";
            html+=   "<p onclick='lbsPerson("+uid+")' class='user_name'>"+username+"</p>";
            html+=  " </div>";
            html+=  "<p class='discuss_content'>"+odz_smiley_parse(message)+"</p>";
            html+=  "</div>";
            html+=  " </li>";
        $(window).unbind('scroll');
        if (tagindex == 1) {
            divFeedItem.append(html);
            tagindex = 1;
        }
        var oBody = $('body')[0];
        var scrollTop = oBody.scrollHeight - $(window).height();
        scrollTop = scrollTop + 30;
        $('body').animate({scrollTop:scrollTop}, 300, '', function() {
            $(window).bind('scroll');
        });
    };
    // 解析帖子内容中的表情
    function odz_smiley_parse(message) {   
        for(var serach_key in smiley_search){
            var replace = smiley_search[serach_key];
            var serach_key = quote(serach_key);
            message = message.replace(new RegExp(serach_key, 'g'), replace);
        }
        return message;
    }
    //表情解析转义
    function quote(text){
        var str = ['.','+','*','?','[','^',']','$','(',')','{','}','=','','<','>','|'];
        for(var id in str){                 
            if(str[id] == ''){
                continue;
            }
            text = text.replace(new RegExp('\\'+str[id], 'g'), '\\'+str[id]);
        }
        return text;
    }